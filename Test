<div class="p-5">
  <h2>Create New Simulation</h2>

  <mat-form-field class="example-full-width w-[450px]">
    <mat-label>Select Instruments</mat-label>
    
    <mat-select [formControl]="selectionControl" multiple>
      
      <mat-form-field
        appearance="outline"
        class="sticky top-0 z-[100] bg-white w-full box-border pt-2 px-3 pb-0"
      >
        <mat-label>Start typing to search...</mat-label>
        <input
          matInput
          [formControl]="searchControl"
          (keydown)="$event.stopPropagation()" 
        />
        @if (isSearching()) {
        <mat-progress-spinner
          matSuffix
          mode="indeterminate"
          [diameter]="20"
        ></mat-progress-spinner>
        }
      </mat-form-field>

      @for (option of searchResults(); track option.id) {
        <mat-option [value]="option">
        
        <div class="flex flex-col leading-snug py-0.5">
            
            <span class="font-semibold text-base">
              {{ option.isin }}
            </span>
            
            <span class="text-sm text-gray-700">
              {{ option.issuer }}
            </span>
            
            <span class="text-sm text-gray-600">
              Coupon: <strong class="font-medium">{{ option.coupon }}%</strong> | 
              Principal: <strong class="font-medium">{{ option.principal | number }}</strong>
            </span>
          </div>
        </mat-option>
      }

      @if (isSearching() && searchResults().length === 0) {
        <mat-option disabled>Loading...</mat-option>
      }
      @if (!isSearching() && searchTerm().length > 0 && searchResults().length === 0) {
        <mat-option disabled>No results found</mat-option>
      }

    </mat-select>
  </mat-form-field>

  <hr class="my-5" />

  <h3>Simulation Instruments</h3>

  <ag-grid-angular
    class="ag-theme-quartz w-full h-[500px]"
    [rowData]="rowData()"
    [columnDefs]="colDefs()"
  >
  </ag-grid-angular>
</div>
